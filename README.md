# MiniDB（C 语言命令行学生记录管理系统）

一个基于终端的轻量级记录管理系统，使用 C 语言链表、结构体、指针和文件 I/O 实现。支持记录的**增删改查、排序、搜索、文件持久化、位操作状态管理**等功能。

## 功能特性

### 核心功能

- **记录管理**：添加、删除、查看、查找记录（按 ID 或姓名）
- **多字段排序**：按 ID、姓名、年龄、成绩排序（使用 `qsort`）
- **统计信息**：记录总数、平均分、最高/最低分、最大/最小年龄
- **文件持久化**：二进制格式保存/加载、CSV 格式导入/导出
- **状态管理**：使用位操作管理记录状态（只读/已归档/VIP/软删除）
- **自动保存**：程序退出时自动保存数据

### 主菜单

```
=========== MiniDB 学生记录管理系统 ===========
当前记录数：N
-------------------------------------------------
1. 添加记录    2. 查看全部    3. 按 ID 查找
4. 按姓名查找  5. 按 ID 删除  6. 排序记录
7. 文件操作    8. 统计信息    9. 记录状态
0. 退出系统
-------------------------------------------------
```

## 目录结构

```
minidb/
├── main.c              # 程序入口：主菜单循环与命令分发
├── db.c / db.h         # 数据库核心：链表 CRUD、排序、统计、状态管理
├── io.c / io.h         # 文件 I/O：二进制保存/加载、CSV 导入/导出
├── utils.c / utils.h   # 工具函数：输入验证、缓冲区清理
├── config.h            # 宏定义：常量、调试开关、定宽类型
├── Makefile            # 编译脚本
├── minidb.md           # 详细设计文档与迭代计划
└── README.md           # 本文件
```

## 构建说明（Windows / MinGW）

### 环境要求

- GCC 编译器（推荐 MinGW-w64）
- GNU Make

### 编译

```powershell
mingw32-make
```

### 清理

```powershell
mingw32-make clean
```

> **注意**：`Makefile` 中的 `clean` 目标使用 Windows 的 `del` 命令。如果在 MSYS2 bash 环境中运行，可能需要将 `del` 改为 `rm -f`。

## 运行

编译成功后，在 PowerShell 中运行：

```powershell
.\program.exe
```

## 详细功能说明

### 1. 添加记录

- 自动分配递增 ID
- 输入验证：姓名（非空、长度≤64）、年龄（1-150）、成绩（0-100）

### 2. 查找功能

- **按 ID 查找**：精确匹配学生 ID
- **按姓名查找**：支持模糊搜索（使用 `strstr`）

### 3. 排序功能

子菜单选项：
1. 按 ID 排序
2. 按姓名排序（字典序）
3. 按年龄排序
4. 按成绩排序

### 4. 文件操作

| 选项 | 功能 | 文件格式 |
|------|------|----------|
| 1 | 保存 | 二进制 `.dat` |
| 2 | 加载 | 二进制 `.dat` |
| 3 | 导出 | CSV 文本 |
| 4 | 导入 | CSV 文本 |

### 5. 统计信息

输出以下内容：
- 记录总数
- 成绩：平均分、最高分、最低分
- 年龄：最大年龄、最小年龄

### 6. 记录状态管理

使用 4 位位字段存储状态：

| 标志位 | 含义 |
|--------|------|
| `FLAG_READONLY` (0x01) | 只读 |
| `FLAG_ARCHIVED` (0x02) | 已归档 |
| `FLAG_VIP` (0x04) | VIP |
| `FLAG_DELETED` (0x08) | 软删除 |

子菜单支持切换各标志位或查看所有记录状态。

## 技术特点

- **链表结构**：使用带哨兵节点的单向链表，简化边界处理
- **动态内存**：`malloc`/`free` 动态管理记录，无条数限制
- **位操作**：用 `uint8_t` 的低 4 位存储记录状态，支持异或切换
- **函数指针**：配合 `qsort` 实现多字段排序
- **C99 标准**：使用 `stdint.h`、`stdbool.h` 提供定宽类型和布尔类型
- **错误处理**：所有 I/O 操作均检查返回值，输入失败时清理缓冲区
- **自动保存**：使用 `atexit()` 注册退出时的保存函数

## 数据结构

```c
// 记录结构体（链表节点）
typedef struct Record {
    int id;                     // 学生 ID
    char name[64];              // 姓名
    int age;                    // 年龄
    double score;               // 成绩
    uint8_t flags;              // 位字段状态
    struct Record *next;        // 链表指针
} Record;

// 数据库结构体
typedef struct Database {
    Record *head;               // 哨兵头节点
    int count;                  // 记录总数
    int next_id;                // 下一个可用 ID
} Database;
```

## 备注

- 数据默认保存为 `minidb.dat`（二进制格式）
- CSV 导出文件为 `minidb.csv`
- 程序启动时会自动检测并加载已保存的数据
- 调试模式下可定义 `DEBUG` 宏启用调试输出

## 相关文档

- [`minidb.md`](minidb.md) - 详细的项目设计文档，包含迭代开发计划和知识点覆盖表
