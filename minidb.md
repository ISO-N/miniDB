## 项目概述

**MiniDB** 是一个基于终端的轻量级记录管理系统（类似迷你数据库），支持对结构化数据的**增删改查、排序、搜索、文件持久化**等操作。项目目标是**系统性运用《C语言程序设计：现代方法》全书知识点**，通过不断迭代的方式，从最简版本逐步演进到功能完整的多文件工程。

<aside>
🎯

**核心理念**：边学边做，每完成书中一部分内容，就在项目中加入对应功能并重构，最终形成一个可展示的完整作品。

</aside>

---

## 项目功能设计

### 基础功能

- **记录管理**：增加、删除、修改、查看记录（如学生信息、图书、通讯录等）
- **交互式菜单**：终端命令行菜单驱动，支持用户输入指令
- **内存存储**：运行期间用数组或链表在内存中管理数据

### 进阶功能

- **文件持久化**：支持二进制文件保存/加载，文本格式导入/导出（CSV）
- **多字段排序与搜索**：按姓名、ID、日期等字段排序和模糊搜索
- **权限与状态标志**：用位操作管理记录的状态（如：只读、已归档、VIP 等）
- **统计分析**：对数值字段求和、平均、最大/最小值
- **国际化支持**（选做）：支持中文等宽字符的输入与显示

---

## 迭代开发计划

<aside>
💡

建议按照以下 6 个阶段迭代开发，每个阶段对应书中若干章节的知识点。**先写出能运行的最简版本，再逐步重构和扩展**。

</aside>

### 阶段一：最简原型 — 数组 + 菜单

**目标**：用最基础的语法实现一个能跑的 CRUD 原型

**对应书中章节**：

| 章节 | 知识点 | 项目中的运用 |
| --- | --- | --- |
| 第2章 基本概念 | 变量、赋值、`printf` | 基本输出与变量声明 |
| 第3章 格式化 I/O | `scanf` / `printf` 格式化 | 用户输入与格式化输出 |
| 第4章 表达式 | 运算符、类型转换 | 数据计算与条件判断 |
| 第5章 选择语句 | `if` / `switch` | 菜单分支逻辑 |
| 第6章 循环 | `while` / `for` / `do-while` | 主循环、遍历数组 |
| 第7章 基本类型 | `int` / `char` / `float` / 类型转换 | 记录字段类型定义 |
| 第8章 数组 | 一维/二维数组 | 用数组存储记录 |

**交付物**：

- [x]  固定大小数组存储记录（如最多 100 条）
- [x]  终端菜单：1-添加 2-查看全部 3-按ID查找 4-退出
- [x]  每条记录包含：ID、姓名、年龄、成绩

---

### 阶段二：函数化重构 + 字符串处理

**目标**：用函数拆分代码，加入字符串操作能力

**对应书中章节**：

| 章节 | 知识点 | 项目中的运用 |
| --- | --- | --- |
| 第9章 函数 | 函数定义、原型、参数传递 | 拆分为 `add_record()`、`find_record()` 等 |
| 第10章 程序结构 | 局部/外部变量、作用域 | 全局记录数组 vs 局部变量的取舍 |
| 第13章 字符串 | 字符串库函数、字符数组 | 姓名的存储、比较、搜索 |

**交付物**：

- [x]  所有功能拆分为独立函数
- [x]  支持按姓名模糊搜索（`strstr`）
- [x]  输入校验：姓名长度、成绩范围

---

### 阶段三：指针 + 链表 + 结构体（单文件）

**目标**：用结构体定义数据模型，用指针和动态内存实现链表，替代固定数组

**对应书中章节**：

| 章节 | 知识点 | 项目中的运用 |
| --- | --- | --- |
| 第11章 指针 | 指针基础、指针作为参数 | 函数通过指针修改数据 |
| 第12章 指针和数组 | 指针运算、数组与指针 | 遍历记录的指针方式 |
| 第16章 结构、联合、枚举 | `struct` / `enum` | 用 `struct Record` 定义记录，`enum` 定义菜单命令和状态 |
| 第17章 指针高级应用 | `malloc` / `free`、链表 | 用链表动态管理记录，不再限制条数 |

**交付物**：

- [x]  定义 `struct Record`（含 `id`、`name`、`age`、`score`、`next` 指针）和 `Database` 结构体
- [x]  用 `enum Command` 定义菜单命令
- [x]  用单链表替代固定数组，支持动态添加和删除节点
- [x]  按 ID 查找、按姓名模糊搜索改为链表遍历
- [x]  程序退出时释放所有内存（无内存泄漏）
- [x]  保持单文件结构，多文件拆分留到阶段四

---

### 阶段四：多文件工程重构

**目标**：将单文件拆分为多文件工程，掌握模块化编译和预处理器

**对应书中章节**：

| 章节 | 知识点 | 项目中的运用 |
| --- | --- | --- |
| 第14章 预处理器 | 宏、条件编译、`#include` 守卫 | `DEBUG` 宏、平台兼容、头文件保护 |
| 第15章 编写大规模程序 | 头文件、源文件、编译链接 | 拆分为多个 `.c` / `.h` 文件 |
| 第18章 声明 | 存储类型、`typedef`、`inline` | `typedef struct` 简化类型名 |

**推荐的文件结构**：

```
minidb/
├── main.c          // 入口：主菜单循环
├── db.h / db.c     // 数据库核心：链表增删改查
├── io.h / io.c     // 文件读写：保存、加载、导入导出
├── utils.h / utils.c  // 工具函数：输入校验、字符串处理
├── config.h        // 宏定义、调试开关、常量
└── Makefile        // 编译脚本
```

**交付物**：

- [x]  完成多文件拆分，`make` 一键编译
- [x]  用 `typedef struct` 简化类型名
- [x]  用 `#ifdef DEBUG` 控制调试输出
- [x]  头文件使用 `#ifndef` 守卫

---

### 阶段五：文件 I/O + 排序 + 错误处理

**目标**：实现数据的持久化存储，加入健壮的错误处理

**对应书中章节**：

| 章节 | 知识点 | 项目中的运用 |
| --- | --- | --- |
| 第22章 输入/输出 | `fopen` / `fread` / `fwrite` / `fprintf` | 二进制文件保存与加载、CSV 导入导出 |
| 第24章 错误处理 | `errno`、`assert`、`<signal.h>` | 文件打开失败、内存不足、非法输入的优雅处理 |
| 第26章 其他库函数 | `qsort`、`bsearch`、`atexit` | 多字段排序、二分查找、退出时自动保存 |
| 第23章 数值和字符支持 | `<string.h>`、`<ctype.h>`、`memcpy` | 字符串操作、输入清理、内存拷贝 |
| 第21章 标准库 | `<stddef.h>`、`<limits.h>` | 类型边界检查、`offsetof` |

**交付物**：

- [x]  `save` / `load` 命令：二进制文件持久化
- [x]  `export` / `import` 命令：CSV 文本格式
- [x]  `sort` 命令：按任意字段排序（用 `qsort` + 函数指针）
- [x]  所有可能失败的操作都有错误提示，不会崩溃
- [x]  `atexit()` 注册退出时自动保存

---

### 阶段六：高级特性 — 位操作、国际化、数学支持

**目标**：覆盖书中剩余的高级章节

**对应书中章节**：

| 章节 | 知识点 | 项目中的运用 |
| --- | --- | --- |
| 第20章 低级程序设计 | 位运算、位字段 | 用位字段存储记录状态标志（只读 / 已归档 / VIP / 已删除） |
| 第19章 程序设计 | 模块设计、信息隐藏、抽象数据类型 | 对外暴露接口、隐藏内部实现 |
| 第25章 国际化特性 | `<wchar.h>`、`<locale.h>`、宽字符 | 支持中文姓名的输入输出 |
| 第27章 C99 数学支持 | `<stdint.h>`、`<stdbool.h>` | 使用固定宽度整数类型、`bool` 类型 |

**交付物**：

- [x]  记录状态用 `uint8_t` 位字段表示，支持 `flag` 命令切换状态
- [x]  统计命令 `stats`：输出记录总数、平均成绩、最高/最低分
- [x]  （选做）`setlocale` + 宽字符支持中文
- [x]  对外接口与内部实现分离（`.h` 只暴露必要函数）

---

## 知识点覆盖总表

| **章节** | **主题** | **开发阶段** |
| --- | --- | --- |
| 第2-8章 | 基础语法、数组、类型、控制流 | 阶段一 ✅ |
| 第9-10章 | 函数、程序结构 | 阶段二 ✅ |
| 第13章 | 字符串 | 阶段二 ✅ |
| 第11-12章 | 指针基础 | 阶段三 ✅ |
| 第16章 | 结构体、枚举 | 阶段三 ✅ |
| 第17章 | 动态内存、链表 | 阶段三 ✅ |
| 第14-15章 | 预处理器、多文件 | 阶段四 ✅ |
| 第18章 | 声明 | 阶段四 ✅ |
| 第19章 | 程序设计（模块化） | 阶段六 ✅ |
| 第20章 | 低级编程（位操作） | 阶段六 ✅ |
| 第21-24章 | 标准库、I/O、错误处理 | 阶段五 ✅ |
| 第25章 | 国际化 | 阶段六 ✅ |
| 第26章 | `qsort` / `bsearch` 等 | 阶段五 ✅ |
| 第27章 | C99 数学与类型支持 | 阶段六 ✅ |

---

## 示例：核心数据结构设计

```c
// config.h
#ifndef CONFIG_H
#define CONFIG_H

#include <stdbool.h>
#include <stdint.h>

#define MAX_NAME_LEN  64
#define DB_FILENAME   "minidb.dat"
#define CSV_FILENAME  "minidb.csv"

// 调试模式开关
#ifdef DEBUG
  #define DEBUG_PRINT(fmt, ...) fprintf(stderr, "[DEBUG] " fmt "\n", ##__VA_ARGS__)
#else
  #define DEBUG_PRINT(fmt, ...)
#endif

#endif
```

```c
// db.h
#ifndef DB_H
#define DB_H

#include "config.h"

// 记录状态标志（位字段）
#define FLAG_READONLY  (1 << 0)  // 0x01 只读
#define FLAG_ARCHIVED  (1 << 1)  // 0x02 已归档
#define FLAG_VIP       (1 << 2)  // 0x04 VIP
#define FLAG_DELETED   (1 << 3)  // 0x08 软删除

// 菜单命令枚举
typedef enum {
    CMD_ADD = 1,
    CMD_DELETE,
    CMD_UPDATE,
    CMD_FIND,
    CMD_LIST,
    CMD_SORT,
    CMD_STATS,
    CMD_SAVE,
    CMD_LOAD,
    CMD_EXPORT,
    CMD_IMPORT,
    CMD_FLAG,
    CMD_QUIT
} Command;

// 记录结构体
typedef struct Record {
    int id;
    char name[MAX_NAME_LEN];
    int age;
    double score;
    uint8_t flags;           // 位字段状态
    struct Record *next;     // 链表指针
} Record;

// 数据库结构体
typedef struct {
    Record *head;            // 链表头
    int count;               // 记录总数
    int next_id;             // 自增 ID
} Database;

// 公开接口
Database *db_create(void);
void      db_destroy(Database *db);
bool      db_add(Database *db, const char *name, int age, double score);
bool      db_delete(Database *db, int id);
Record   *db_find_by_id(Database *db, int id);
Record   *db_find_by_name(Database *db, const char *keyword);
void      db_list_all(const Database *db);
void      db_sort(Database *db, int field);
void      db_stats(const Database *db);
bool      db_toggle_flag(Database *db, int id, uint8_t flag);

#endif
```

---

## 拓展方向

完成以上 6 个阶段后，如果还想继续深入，可以考虑：

1. **网络化**：加入 Socket 编程，做成 C/S 架构的数据库（超出本书范围，但非常有价值）
2. **脚本解释器**：支持简单的查询语言，如 `SELECT name WHERE score > 90`
3. **图形界面**：用 ncurses 做终端 UI（表格、高亮、翻页）
4. **性能优化**：加入哈希表索引，对比链表和哈希表的查询效率
5. **单元测试**：用 `assert` 或第三方测试框架为每个模块写测试

---

<aside>
🚀

**开始行动**：建议先从**阶段一**开始，用不超过 100 行代码写出最简原型，能跑起来再说。完美是迭代出来的，不是设计出来的！

</aside>